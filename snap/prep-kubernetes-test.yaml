name: kubernetes-test
version: '$KUBE_ERSION'
summary: tests for kubernetes
description: |
  tests for kubernetes
grade: stable
confinement: classic

apps:
  e2e:
    command: ginkgo-e2e
    # These will be needed for strict confinement:
    # plugs:
    #   - network
    #   - network-bind
    #   - home

parts:
  kubernetes-test:
    plugin: dump
    source: build
    prepare: |
      set -eu
      export KUBE_ARCH=`dpkg --print-architecture`
      mkdir build-temp
      (cd build-temp
        curl -LO https://dl.k8s.io/v$KUBE_ERSION/kubernetes-test.tar.gz
        tar -xf "kubernetes-test.tar.gz"
        mv kubernetes/platforms/linux/$KUBE_ARCH/e2e.test ..
        mv kubernetes/platforms/linux/$KUBE_ARCH/ginkgo ..
      )
      rm -rf build-temp
      chmod +rx e2e.test
      chmod +rx ginkgo
      cp ../../../shared/ginkgo-e2e .
