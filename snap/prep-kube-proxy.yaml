name: kube-proxy
version: '$KUBE_ERSION'
summary: Kubernetes network proxy runs on each node.
description: |
  The Kubernetes network proxy runs on each node. This reflects services as
  defined in the Kubernetes API on each node and can do simple TCP,UDP stream
  forwarding or round robin TCP,UDP forwarding across a set of backends. Service
  cluster ips and ports are currently found through Docker-links-compatible
  environment variables specifying ports opened by the service proxy. There is
  an optional addon that provides cluster DNS for these cluster IPs. The user
  must create a service with the apiserver API to configure the proxy.
grade: stable
confinement: classic

apps:
  daemon:
    command: run-with-config-args kube-proxy
    daemon: simple
  kube-proxy:
    command: kube-proxy

parts:
  kube-proxy:
    plugin: dump
    source: build
    prepare: |
      set -eu
      export KUBE_ARCH=`dpkg --print-architecture`
      curl -LO https://dl.k8s.io/v$KUBE_ERSION/bin/linux/${KUBE_ARCH}/kube-proxy
      chmod +x kube-proxy
      cp ../../../shared/run-with-config-args .
      ../../../shared/generate-configure-hook kube-proxy
